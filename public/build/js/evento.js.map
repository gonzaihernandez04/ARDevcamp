{"version":3,"sources":["evento.js"],"names":["document","querySelector","busqueda","categoria_id","dia","dias","querySelectorAll","inputHiddenHora","terminoBusqueda","e","target","name","value","async","Object","values","includes","url","console","log","respuesta","fetch","eventos","horasTomadas","map","evento","hora_id","listadoHoras","listadoHorasArray","Array","from","filter","li","dataset","horaId","forEach","horario","classList","remove","hora","addEventListener","seleccionarHora","obtenerHorasDisponibles","json","buscarEventos","horaPrevia","add"],"mappings":"AAAA,MAGE,GAFgBA,SAASC,cAAc,UAE1B,CACX,IAAIC,EAAW,CACbC,aAAc,GACdC,IAAK,IAEP,MAAMC,EAAOL,SAASM,iBAAiB,gBAEjCC,GADiBP,SAASC,cAAc,mBACtBD,SAASC,cAAc,qBAM/C,SAASO,EAAgBC,GAEvBP,EAASO,EAAEC,OAAOC,MAAQF,EAAEC,OAAOE,MAKrCC,iBAEI,GAAGC,OAAOC,OAAOb,GAAUc,SAAS,IAChC,OAEJ,MAAMC,EAAM,qCAAqCf,EAASC,uBAAuBD,EAASE,MAG1F,GAFAc,QAAQC,IAAIF,GAETA,EAAI,CACH,MAAMG,QAAkBC,MAAMJ,IAOtC,UAAiCK,QAACA,IAG9B,GAAGA,EAAQ,CACP,MAAMC,EAAeD,EAAQE,IAAKC,GAAUA,EAAOC,SAK7CC,EAAe3B,SAASM,iBAAiB,aAGzCsB,EAAoBC,MAAMC,KAAKH,GAEXC,EAAkBG,OAAOC,IAAMT,EAAaP,SAASgB,EAAGC,QAAQC,SAExEC,QAAQC,IACtBA,EAAQC,UAAUC,OAAO,uBAGJtC,SAASM,iBAAiB,aAElC6B,QAAQI,IACrBA,EAAKC,iBAAiB,QAAQC,MA3BlCC,OADsBtB,EAAUuB,SAdtCC,GA+CF,SAASH,EAAgBhC,GAKrB,MAAMoC,EAAa7C,SAASC,cAAc,8BAC1CiB,QAAQC,IAAI0B,GACTA,GACCA,EAAWR,UAAUC,OAAO,6BAEhC7B,EAAEC,OAAO2B,UAAUS,IAAI,6BACvBvC,EAAgBK,MAAQH,EAAEC,OAAOuB,QAAQC,OAnE3BlC,SAASC,cAAc,yBAE/BuC,iBAAiB,SAAUhC,GACrCH,EAAK8B,QAAS/B,GAAQA,EAAIoC,iBAAiB,SAAUhC,MAdzD","file":"evento.js","sourcesContent":["(() => {\r\n  const ulHoras = document.querySelector(\".horas\");\r\n\r\n  if (ulHoras) {\r\n    let busqueda = {\r\n      categoria_id: \"\",\r\n      dia: \"\",\r\n    };\r\n    const dias = document.querySelectorAll('[name=\"dia\"]');\r\n    const inputHiddenDia = document.querySelector('[name=\"dia_id\"]');\r\n    const inputHiddenHora = document.querySelector('[name=\"hora_id\"]');\r\n    const categoria = document.querySelector('[name=\"categoria_id\"]');\r\n\r\n    categoria.addEventListener(\"change\", terminoBusqueda);\r\n    dias.forEach((dia) => dia.addEventListener(\"change\", terminoBusqueda));\r\n\r\n    function terminoBusqueda(e) {\r\n      // Lleno el dia o la categoria en el objeto segun el seleccionado\r\n      busqueda[e.target.name] = e.target.value;\r\n\r\n      buscarEventos();\r\n    }\r\n\r\n    async function buscarEventos(){\r\n\r\n        if(Object.values(busqueda).includes(\"\")){\r\n            return;\r\n        }\r\n        const url = `/api/eventos-horario?categoria_id=${busqueda.categoria_id}&dia_id=${busqueda.dia}`\r\n        console.log(url);\r\n        \r\n        if(url){\r\n            const respuesta = await fetch(url);\r\n            \r\n            const eventos = await respuesta.json();\r\n            obtenerHorasDisponibles(eventos);\r\n            \r\n        }\r\n    }\r\n    function obtenerHorasDisponibles({eventos}){\r\n        // Comprobar eventos ya tomados y quitar variable de deshabilitado.\r\n    \r\n        if(eventos){\r\n            const horasTomadas = eventos.map( evento => evento.hora_id);\r\n            \r\n\r\n            \r\n            // Obtengo todas las horas y recorro otro listado de horas, el cual devolvera las horas que estan tomadas.\r\n            const listadoHoras = document.querySelectorAll(\"#horas li\");\r\n\r\n            // Convierto Node LIST en ARRAY\r\n            const listadoHorasArray = Array.from(listadoHoras);\r\n\r\n            const horariosNoTomados = listadoHorasArray.filter(li=> !horasTomadas.includes(li.dataset.horaId));\r\n\r\n            horariosNoTomados.forEach(horario=>{\r\n                horario.classList.remove('horas__hora--none');\r\n            })\r\n            \r\n            const horasDisponibles = document.querySelectorAll('#horas li');\r\n\r\n            horasDisponibles.forEach(hora=>{\r\n                hora.addEventListener('click',seleccionarHora);\r\n            });\r\n        }\r\n       \r\n    }\r\n    function seleccionarHora(e) {\r\n\r\n\r\n        // Deshabilita la hora previa si hay un nuevo click\r\n\r\n        const horaPrevia = document.querySelector('.horas__hora--seleccionado');\r\n        console.log(horaPrevia);\r\n        if(horaPrevia){\r\n            horaPrevia.classList.remove('horas__hora--seleccionado');\r\n        }\r\n        e.target.classList.add('horas__hora--seleccionado');\r\n        inputHiddenHora.value = e.target.dataset.horaId;\r\n\r\n       \r\n    }\r\n \r\n  }\r\n})();\r\n"]}